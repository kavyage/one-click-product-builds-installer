/*
 * This file was generated by the Gradle 'init' task.
 *
 * This project uses @Incubating APIs which are subject to change.
 */

plugins {
    id 'groovy'
}

repositories {
    mavenCentral()
}

dependencies {
    implementation 'org.apache.groovy:groovy:4.0.19'
    implementation "commons-io:commons-io:2.9.0"
    implementation "net.lingala.zip4j:zip4j:2.11.5"
    implementation "com.github.junrar:junrar:7.5.0"
    implementation "org.apache.commons:commons-lang3:3.14.0"
    implementation "commons-cli:commons-cli:1.4"
}

group = 'com.abc.etools'
version = '1.0'
description = 'one-click-product-builds-installer'

tasks.register("copyGroovy") {
    doLast {
        copy {
            from("$projectDir/src/main/groovy")
            include("*.groovy", "customization/**")
            into("$projectDir/build/result/scripts")
        }
    }
}

tasks.register("copyResources") {
    doLast {
        copy {
            from("$projectDir/src/main/resources")
            into("$projectDir/build/result")
        }
    }
}

task copySdk(type: Copy) {
    from "$projectDir/apache-groovy-sdk-4.0.19-min.zip"
    into "$projectDir/build/result"
    filesMatching '*.zip', { zipDetails ->
        copy {
            from zipTree(zipDetails.file)
            into destinationDir
        }
        zipDetails.exclude()
    }
}

task copyAllDependencies(type: Copy) {
    from configurations.runtimeClasspath
    into "$projectDir/build/result/lib"
}

task zipResult(type: Zip) {
    dependsOn(copyAllDependencies, "copyGroovy", "copyResources", "copySdk")
    from "$projectDir/build/result/"
    archiveFileName = "one-click-product-builds-installer-${version}.zip"
    destinationDirectory = file("$projectDir/build")
}

build.dependsOn("zipResult")


